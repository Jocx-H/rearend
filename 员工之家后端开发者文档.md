<h1 align="center">员工之家——接口设计文档</h1>

<h3 align="center">目&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp录


[toc]



<div STYLE="page-break-after: always;"></div>

## 一、模型介绍

#### 模型概述

利用FastAPI提供的自动检验功能，后端人员根据需求构建了一系列供前端开发使用的数据模型。

---

__前端返回请求数据__

### 1. 用户模型

```python
class User(BaseModel):
    username: str                                   # 账号，必填，长度1~20
    password: str                                   # 密码，必填，长度
    status: Status                                  # 身份，必填，1为管理员，2为普通用户
    name: Optional[str]                             # 姓名，可填，长度1~20
    sex: Optional[Sex]                              # 性别，可填，1为男，2为女
    card_id: Optional[str]                          # 身份证号，可填，长度固定18
    avatar_url: Optional[HttpUrl]                   # 头像，可填，必须是连接
    department: Optional[str]                       # 部门，可填，长度1~50
    job: Optional[str]                              # 职位，可填，长度1~50
    address: Optional[str]                          # 家庭地址，可填，长度
    post_code: Optional[str]                        # 邮政编码，可填，长度固定6
    tel: Optional[str]                              # 固定电话，可填，长度16
    phone: Optional[str]                            # 手机号码，可填，长度11
    qq_num: Optional[str]                           # QQ号，可填，长度6~12
    email: Optional[EmailStr]                       # 邮箱，可填，长度为，必须是邮件地址
    party: Optional[str]                            # 政治面貌，可填，长度1~10
    birthday: Optional[date]                        # 生日，可填，必须是date对象，格式为YY-MM-DD
    nationality: Optional[str]                      # 国籍，可填，长度1~100
    education: Optional[str]                        # 学历，可填, 长度1~10
    speciality: Optional[str]                       # 转长，可填，长度1~10
    hobby: Optional[str]                            # 兴趣爱好，可填，长度1~10
    remark: Optional[str]                           # 备注，可填，长度1~500
    create_time: Optional[datetime]                 # 注册时间，可填，必须是datetime对象，格式为YY-MM-DD hh:mm:ss
    face_url: Optional[HttpUrl]                     # 人脸注册图片链接，可填，必须是连接
```

### 2. 文件模型

```python
class Document(BaseModel):
    title: Optional[str]                            # 文件标题，可填，长度1~50
    remark: Optional[str]                           # 文件备注，可填，最大长度300
    create_time: Optional[datetime]                 # 上传时间，可填，必须为datetime对象
    username: Optional[str]                         # 上传者账号，可填，长度1~20
```

### 3. 部门模型

```python
class Department(BaseModel):
    name: str                                       # 部门名称，必填，长度1~50
    remark: Optional[str]                           # 部门备注，可填，最长300
```

### 4. 职位模型

```python
class Job(BaseModel):
    name: str                                       # 职位名称，必填，长度1~50
    remark: Optional[str]                           # 职位备注，可填，最长300
```

### 5. 公告模型

```python
class Notice(BaseModel):
    title: str                                      # 通知标题，必填，长度1~50
    content: Optional[str]                          # 通知内容，可填，最长300
    create_time: Optional[datetime]                 # 通知创建时间，可填，必须datetime对象，格式YY-MM-DD hh:mm:ss
    username: str                                   # 创建者账号，可填，长度1~20
```

---

__后端返回前端的补充信息__

### 6.  返回代码模型

*  错误代码400：客户端运行错误

```python
class Code400(BaseModel):
    detail: str                                     # 错误详细信息，不填
```

* 错误代码403：客户端请求权限不足

```python
class Code403(BaseModel):
    detail: str                                     # 错误详细信息，不填
```



## 二、接口介绍

#### 接口整体概述

员工之家后端接口，以下简称接口，共分三层。从上至下为：控制层、服务层和逻辑层，每一层都为上一层提供服务，控制层为前端提供服务。效果如果所示：
![image-20210903172204242](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210903172204242.png)

__注意__：下文中提到的各种类信息，其属下请在对应模型界面查看。

---

### 1. 控制层接口

通过调用服务层的函数，专注于向前端提供接口。

#### 用户相关接口

* ```python
  async def add_user(user)
  ```

  功能描述：添加员工，员工的username必填，password默认为123456, 默认权限为普通用户，不需要填create_time

  METHOD：GET

  url：/api/user/add_user

  >请求参数：
  >
  >| 字段 | 类型         | 默认值 | 说明         | 是否必必须 |
  >| ---- | ------------ | ------ | ------------ | ---------- |
  >| user | 请求体，User | /      | 被添加的员工 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_user(username)
  ```

  功能描述：删除员工，以路径参数username唯一指定

  METHOD：DELETE

  url：/api/user/remove{username}

  >请求参数：
  >
  >| 字段     | 类型 | 默认值 | 说明       | 是否必必须 |
  >| -------- | ---- | ------ | ---------- | ---------- |
  >| username | str  | /      | 员工的账号 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def get_all_users(limit, skip)
  ```

  功能描述：获取多位员工的信息

  METHOD：get

  url：/api/user/get-all

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| limit | int  | 10     | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def search_user(name)
  ```

  功能描述：根据username或name搜索指定员工

  METHOD：get

  url：/api/user/search/{name}

  >请求参数：
  >
  >| 字段 | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ---- | ---- | ------ | -------------------- | ---------- |
  >| name | str  | /      | 一次性返回的数据条数 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def get_user(where, limit, skip)
  ```

  功能描述：获取指定条件(where)的员工信息

  METHOD：post

  url：/api/user/get

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| where | User | /      | 筛选条件             | 是         |
  >| limit | int  | /      | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def update_user(user, username)
  ```

  功能描述：更新员工信息

  METHOD：put

  url：/api/user/update/{username}

  >请求参数：
  >
  >| 字段     | 类型 | 默认值 | 说明         | 是否必必须 |
  >| -------- | ---- | ------ | ------------ | ---------- |
  >| user     | User | /      | 新的员工信息 | 是         |
  >| username | str  | /      | 员工账号     | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def change_avatar(file, username)
  ```

  功能描述：修改用户的头像，以路径参数username指定用户

  METHOD：post

  url：/api/user/change-avatar/{username}

  >请求参数：
  >
  >| 字段     | 类型 | 默认值 | 说明               | 是否必必须 |
  >| -------- | ---- | ------ | ------------------ | ---------- |
  >| username | str  | /      | 员工账号           | 是         |
  >| file     | File | /      | 头像图片（2M以下） | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

---

#### 登录相关接口

* ```python
  async def login(form_data)
  ```

  功能描述：网络登录验证的api，返回has_face=1表示人脸已经注册，0为未注册

  METHOD：post

  url：/api/login/passwd

  > 请求参数：
  >
  > | 字段      | 类型                      | 默认值    | 说明     | 是否必必须 |
  > | --------- | ------------------------- | --------- | -------- | ---------- |
  > | form_data | OAuth2PasswordRequestForm | Depends() | 验证信息 | 是         |
  >
  > 返回参数：
  >
  > | 字段    | 类型   | 说明       | 备注                              |
  > | ------- | ------ | ---------- | --------------------------------- |
  > | code    | int    | 接口状态码 | 成功：200<br />非法操作：422      |
  > | message | str    | 接口信息   | 成功：success<br />失败：失败原因 |
  > | data    | Object | 返回数据   | 成功："has_face"<br />失败：None  |

* ```python
  async def face_recognition(file)
  ```

  功能描述：人脸识别

  METHOD：post

  url：/api/login/face-recognition

  >请求参数：
  >
  >| 字段 | 类型       | 默认值    | 说明     | 是否必必须 |
  >| ---- | ---------- | --------- | -------- | ---------- |
  >| file | UploadFile | File(...) | 人脸图片 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def face_register(username: str, file: UploadFile = File(...))
  ```

  功能描述：人脸注册

  METHOD：post

  url：/api/login/face-register

  >请求参数：
  >
  >| 字段     | 类型       | 默认值    | 说明     | 是否必必须 |
  >| -------- | ---------- | --------- | -------- | ---------- |
  >| username | str        | /         | 员工账号 | 是         |
  >| file     | UploadFile | File(...) | 人脸图片 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

#### 文件相关接口

* ```python
  async def add_document(files, title, username, remark)
  ```

  功能描述：创建document的同时上传文件，支持同一文档(title)多文件上传，若document已存在，也可以用于添加文件

  METHOD：post

  url：/api/document/add

  >请求参数：
  >
  >| 字段     | 类型             | 默认值    | 说明         | 是否必必须 |
  >| -------- | ---------------- | --------- | ------------ | ---------- |
  >| files    | List[UploadFile] | File(...) | 所上传的文件 | 是         |
  >| title    | str              | Form(...) | 标题         | 是         |
  >| username | str              | Form(...) | 员工账号     | 是         |
  >| remark   | UploadFile       | /         | 文件备注     | 否         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_all_documents()
  ```

  功能描述：删除全部文件

  METHOD：delete

  url：/api/document/remove-all

  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_document(title, filename)
  ```

  功能描述：删除指定title的document中的特定文件filename；若不指定文件则删除整个文档

  METHOD：delete

  url：/api/document/remove/{title}

  >请求参数：
  >
  >| 字段     | 类型 | 默认值    | 说明     | 是否必必须 |
  >| -------- | ---- | --------- | -------- | ---------- |
  >| title    | str  | Path(...) | 标题     | 是         |
  >| filename | str  | /         | 文件名字 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def get_all_documents(limit, skip)
  ```

  功能描述：获取全部文件的信息，返回的链接是不带公网IP的

  METHOD：get

  url：/api/document/get-all

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| limit | int  | /      | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def get_document(title, limit, skip)
  ```

  功能描述：获取文件的信息，以title唯一指定，返回的链接是不带公网IP的

  METHOD：get

  url：/api/document/get/{title}

  >请求参数：
  >
  >| 字段  | 类型 | 默认值    | 说明                 | 是否必必须 |
  >| ----- | ---- | --------- | -------------------- | ---------- |
  >| title | str  | Path(...) | 标题                 | 是         |
  >| limit | int  | /         | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0         | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def update_document(document, title)
  ```

  功能描述：获取文件的信息，以title唯一指定，返回的链接是不带公网IP的

  METHOD：put

  url：/api/document/update/{title}

  >请求参数：
  >
  >| 字段     | 类型     | 默认值    | 说明 | 是否必必须 |
  >| -------- | -------- | --------- | ---- | ---------- |
  >| document | Document | /         | 文件 | 是         |
  >| title    | str      | Path(...) | 标题 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |
  >
  >

#### 部门相关接口

* ```python
  async def add_dept(dept)
  ```

  功能描述：添加部门

  METHOD：post

  url：/api/dept/add

  >请求参数：
  >
  >| 字段 | 类型       | 默认值 | 说明 | 是否必必须 |
  >| ---- | ---------- | ------ | ---- | ---------- |
  >| dept | Department | /      | 部门 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_all_depts()
  ```

  功能描述：删除所有部门

  METHOD：delete

  url：/api/dept/remove-all

  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_dept(name)
  ```

  功能描述：删除部门，以name唯一指定

  METHOD：delete

  url：/api/dept/remove/{name}

  >请求参数：
  >
  >| 字段 | 类型 | 默认值    | 说明     | 是否必必须 |
  >| ---- | ---- | --------- | -------- | ---------- |
  >| name | str  | Path(...) | 部门名称 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def get_all_depts(limit, skip)
  ```

  功能描述：获取所有部门的信息

  METHOD：get

  url：/api/dept/get-all

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| limit | int  | /      | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def get_dept(name, limit, skip)
  ```

  功能描述：获取部门的信息，以name唯一指定

  METHOD：get

  url：/api/dept/get/{name}

  >请求参数：
  >
  >| 字段  | 类型 | 默认值    | 说明                 | 是否必必须 |
  >| ----- | ---- | --------- | -------------------- | ---------- |
  >| name  | str  | Path(...) | 部门名字             | 是         |
  >| limit | int  | /         | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0         | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def update_all_depts(dept)
  ```

  功能描述：更新部门的信息，以name唯一指定(若不指定则更新所有部门)

  METHOD：put

  url：/api/dept/update-all

  >请求参数：
  >
  >| 字段 | 类型       | 默认值 | 说明 | 是否必必须 |
  >| ---- | ---------- | ------ | ---- | ---------- |
  >| dept | Department | /      | 部门 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

* ```python
  async def update_dept(dept, name)
  ```

  功能描述：更新部门的信息，以name唯一指定

  METHOD：put

  url：/api/dept/update/{name}

  >请求参数：
  >
  >| 字段     | 类型     | 默认值    | 说明     | 是否必必须 |
  >| -------- | -------- | --------- | -------- | ---------- |
  >| document | Document | /         | 文件     | 是         |
  >| name     | str      | Path(...) | 部门名字 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

#### 职位相关接口

* ```python
  async def add_job(job)
  ```

  功能描述：添加职位

  METHOD：post

  url：/api/job/add

  >请求参数：
  >
  >| 字段 | 类型 | 默认值 | 说明 | 是否必必须 |
  >| ---- | ---- | ------ | ---- | ---------- |
  >| job  | Job  | /      | 职位 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_all_jobs()
  ```

  功能描述：删除所有职位

  METHOD：delete

  url：/api/job/remove-all

  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_job(name)
  ```

  功能描述：删除职位，以name唯一指定

  METHOD：delete

  url：/api/dept/remove/{name}

  >请求参数：
  >
  >| 字段 | 类型 | 默认值    | 说明     | 是否必必须 |
  >| ---- | ---- | --------- | -------- | ---------- |
  >| name | str  | Path(...) | 职位名称 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def get_all_jobs(limit, skip)
  ```

  功能描述：获取所有职位的信息

  METHOD：get

  url：/api/job/get-all

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| limit | int  | /      | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def get_job(name, limit, skip)
  ```

  功能描述：获取职位的信息，以name唯一指定

  METHOD：get

  url：/api/job/get/{name}

  >请求参数：
  >
  >| 字段  | 类型 | 默认值    | 说明                 | 是否必必须 |
  >| ----- | ---- | --------- | -------------------- | ---------- |
  >| name  | str  | Path(...) | 职位名称             | 是         |
  >| limit | int  | /         | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0         | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def update_all_jobs(job)
  ```

  功能描述：更新职位的信息，以name唯一指定(若不指定则更新所有职位)

  METHOD：put

  url：/api/job/update-all

  >请求参数：
  >
  >| 字段 | 类型 | 默认值 | 说明 | 是否必必须 |
  >| ---- | ---- | ------ | ---- | ---------- |
  >| job  | Job  | /      | 职位 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

* ```python
  async def update_job(job, name)
  ```

  功能描述：更新职位的信息，以name唯一指定

  METHOD：put

  url：/api/job/update/{name}

  >请求参数：
  >
  >| 字段 | 类型 | 默认值    | 说明     | 是否必必须 |
  >| ---- | ---- | --------- | -------- | ---------- |
  >| job  | Job  | /         | 文件     | 是         |
  >| name | str  | Path(...) | 职位名字 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

#### 公告相关接口

* ```python
  async def add_notice(title, username, description, content)
  ```

  功能描述：添加公告

  METHOD：post

  url：/api/notice/add

  >请求参数：
  >
  >| 字段        | 类型 | 默认值                   | 说明       | 是否必必须 |
  >| ----------- | ---- | ------------------------ | ---------- | ---------- |
  >| title       | str  | Body(...)                | 公告标题   | 是         |
  >| username    | str  | Body(...)                | 发布人账号 | 是         |
  >| description | str  | The username of notifier | 提示信息   | 是         |
  >| content     | str  | /                        | 公告内容   | 否         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_all_notices()
  ```

  功能描述：删除所有公告

  METHOD：delete

  url：/api/notice/remove-all

  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def remove_notice(title)
  ```

  功能描述：删除职位，以title唯一指定

  METHOD：delete

  url：/api/notice/remove/{name}

  >请求参数：
  >
  >| 字段  | 类型 | 默认值    | 说明     | 是否必必须 |
  >| ----- | ---- | --------- | -------- | ---------- |
  >| title | str  | Path(...) | 公告标题 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功："success"<br />失败：None                 |

* ```python
  async def get_all_notices(limit, skip)
  ```

  功能描述：获取所有公告的信息

  METHOD：get

  url：/api/notice/get-all

  >请求参数：
  >
  >| 字段  | 类型 | 默认值 | 说明                 | 是否必必须 |
  >| ----- | ---- | ------ | -------------------- | ---------- |
  >| limit | int  | /      | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0      | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def get_notice(title, limit, skip)
  ```

  功能描述：获取公告的信息，以title唯一指定

  METHOD：get

  url：/api/notice/get/{name}

  >请求参数：
  >
  >| 字段  | 类型 | 默认值    | 说明                 | 是否必必须 |
  >| ----- | ---- | --------- | -------------------- | ---------- |
  >| title | str  | Path(...) | 公告标题             | 是         |
  >| limit | int  | /         | 一次性返回的数据条数 | 否         |
  >| skip  | int  | 0         | 从第n条数据开始返回  | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                                         |
  >| ------- | ------ | ---------- | ------------------------------------------------------------ |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422              |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因                            |
  >| data    | Object | 返回数据   | 成功：List[Dict[str, Union[str, int, float]]]<br />失败：None |

* ```python
  async def update_all_notices(notice)
  ```

  功能描述：更新职位的信息，以title唯一指定(若不指定则更新所有职位)

  METHOD：put

  url：/api/notice/update-all

  >请求参数：
  >
  >| 字段   | 类型   | 默认值 | 说明 | 是否必必须 |
  >| ------ | ------ | ------ | ---- | ---------- |
  >| notice | Notice | /      | 公告 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

* ```python
  async def update_notice(notice, title)
  ```

  功能描述：更新公告的信息，以title唯一指定

  METHOD：put

  url：/api/notice/update/{title}

  >请求参数：
  >
  >| 字段   | 类型   | 默认值    | 说明     | 是否必必须 |
  >| ------ | ------ | --------- | -------- | ---------- |
  >| notice | Notice | /         | 公告     | 是         |
  >| title  | str    | Path(...) | 公告标题 | 是         |
  >
  >返回参数：
  >
  >| 字段    | 类型   | 说明       | 备注                                            |
  >| ------- | ------ | ---------- | ----------------------------------------------- |
  >| code    | int    | 接口状态码 | 成功：200<br />请求失败：400<br />非法操作：422 |
  >| message | str    | 接口信息   | 成功：success<br />失败：失败原因               |
  >| data    | Object | 返回数据   | 成功：“success”<br />失败：None                 |

---

### 2. 服务层接口

对从逻辑层来的数据进行处理，服务于控制层。

#### 用户相关服务

* ```python
  def decode_info(info)
  ```

  功能描述：将dict里面的内容全部解码成数据库接受的格式

  >| 字段 | 类型 | 默认值 | 说明           | 是否必必须 |
  >| ---- | ---- | ------ | -------------- | ---------- |
  >| info | dict | /      | 需要解析的内容 | 是         |
  >
  >| 返回值类型 | 返回值说明                               |
  >| ---------- | ---------------------------------------- |
  >| dict       | 成功返回整理好的字典，失败则只报错不返回 |

* ```python
  async def change_avatar(file, username)
  ```

  功能描述：修改用户的头像，以路径参数username指定用户

  >| 字段     | 类型       | 默认值 | 说明         | 是否必必须 |
  >| -------- | ---------- | ------ | ------------ | ---------- |
  >| file     | UploadFile | /      | 上传的文件流 | 是         |
  >| username | str        | /      | 员工账号     | 是         |
  >
  >| 返回值类型 | 返回值说明                                      |
  >| ---------- | ----------------------------------------------- |
  >| dict       | 成功返回{'message', 'data'}，失败则只报错不返回 |

* ```python
  def add_user(user)
  ```

  功能描述：添加员工

  >| 字段 | 类型 | 默认值 | 说明 | 是否必必须 |
  >| ---- | ---- | ------ | ---- | ---------- |
  >| user | User | /      | 员工 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回"success"，失败则只报错不返回 |

* ```python
  def remove_user(username)
  ```

  功能描述：删除员工，以username为唯一指定目标

  >| 字段     | 类型 | 默认值 | 说明     | 是否必必须 |
  >| -------- | ---- | ------ | -------- | ---------- |
  >| username | str  | /      | 员工账号 | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回"success"，失败则只报错不返回 |

* ```python
  def update_user(username, user)
  ```

  功能描述：更新员工的信息，以username为唯一指定目标

  >| 字段     | 类型 | 默认值 | 说明     | 是否必必须 |
  >| -------- | ---- | ------ | -------- | ---------- |
  >| username | str  | /      | 员工账号 | 否         |
  >| user     | User | /      | 员工     | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回"success"，失败则只报错不返回 |

* ```python
  def get_user(where, limit, skip)
  ```

  功能描述：获取员工的信息，提供三种查询模式：

     					1. 从数据库第一条开始返回条目
     					2. 根据username查询直接访问一位员工
     					3. 返回符合where条件的员工

  >| 字段  | 类型                              | 默认值 | 说明               | 是否必必须 |
  >| ----- | --------------------------------- | ------ | ------------------ | ---------- |
  >| where | Dict[str, Union[str, int, float]] | /      | 查询条件           | 否         |
  >| limit | int                               | /      | 限制获取的数据条数 | 否         |
  >| skip  | int                               | /      | 需要跳过的数据条数 | 是         |
  >
  >| 返回值类型                              | 返回值说明                               |
  >| --------------------------------------- | ---------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 成功返回整理好的字典，失败则只报错不返回 |

#### 登录相关服务

* ```python
  async def face_add(file, username)
  ```

  功能描述：注册人脸

  >| 字段     | 类型       | 默认值 | 说明             | 是否必必须 |
  >| -------- | ---------- | ------ | ---------------- | ---------- |
  >| file     | UploadFile | /      | 人脸图片的上传流 | 是         |
  >| username | str        | /      | 员工账号         | 是         |
  >
  >| 返回值类型 | 返回值说明 |
  >| ---------- | ---------- |
  >| dict       | 状态信息   |

* ```python
  def detect_face(img_path)
  ```

  功能描述：检测注册的图片是否是人脸

  >| 字段     | 类型 | 默认值 | 说明           | 是否必必须 |
  >| -------- | ---- | ------ | -------------- | ---------- |
  >| img_path | str  | /      | 人脸图片的位置 | 是         |
  >
  >| 返回值类型 | 返回值说明                        |
  >| ---------- | --------------------------------- |
  >| boll       | 检测是人脸返回True，不是返回False |

* ```python
  def compare_face(file_buffer_1, file_buffer_2)
  ```

  功能描述：比较人脸

  >| 字段          | 类型     | 默认值 | 说明      | 是否必 |
  >| ------------- | -------- | ------ | --------- | ------ |
  >| file_buffer_1 | BinaryIO | /      | 人脸图片1 | 是     |
  >| file_buffer_2 | BinaryIO | /      | 人脸图片2 | 是     |
  >
  >| 返回值类型 | 返回值说明                     |
  >| ---------- | ------------------------------ |
  >| int        | 成功返回相似值，失败则返回None |

* ```python
  async def face_recognition(file)
  ```

  功能描述：人脸登录，用于比较人脸信息

  >| 字段 | 类型       | 默认值 | 说明               | 是否必必须 |
  >| ---- | ---------- | ------ | ------------------ | ---------- |
  >| file | UploadFile | /      | 上传上来的图片文件 | 是         |
  >
  >| 返回值类型 | 返回值说明                           |
  >| ---------- | ------------------------------------ |
  >| int        | 成功则返回1或者0，失败则只报错不返回 |

* ```python
  def hash_password(password)
  ```

  功能描述：hd5加密密码

  >| 字段     | 类型 | 默认值 | 说明     | 是否必必须 |
  >| -------- | ---- | ------ | -------- | ---------- |
  >| password | str  | /      | 员工密码 | 是         |
  >
  >| 返回值类型 | 返回值说明         |
  >| ---------- | ------------------ |
  >| str        | 哈希过后的加密密码 |

* ```python
  def login_check(username, password)
  ```

  功能描述：将dict里面的内容全部解码成数据库接受的格式

  >| 字段     | 类型 | 默认值 | 说明     | 是否必必须 |
  >| -------- | ---- | ------ | -------- | ---------- |
  >| username | str  | /      | 员工账号 | 是         |
  >| password | str  | /      | 员工密码 | 是         |
  >
  >| 返回值类型 | 返回值说明 |
  >| ---------- | ---------- |
  >| dict       | 状态信息   |

* ```python
  def has_face(username)
  ```

  功能描述：检测是否注册了人脸

  >| 字段     | 类型 | 默认值 | 说明     | 是否必必须 |
  >| -------- | ---- | ------ | -------- | ---------- |
  >| username | str  | /      | 员工账号 | 是         |
  >
  >| 返回值类型 | 返回值说明                   |
  >| ---------- | ---------------------------- |
  >| int        | 注册了人脸返回1，没有则返回0 |

* ```python
  def decode_info(info)
  ```

  功能描述：将dict里面的内容全部解码成数据库接受的格式

  >| 字段 | 类型 | 默认值 | 说明           | 是否必必须 |
  >| ---- | ---- | ------ | -------------- | ---------- |
  >| info | dict | /      | 需要解析的内容 | 是         |
  >
  >| 返回值类型 | 返回值说明                               |
  >| ---------- | ---------------------------------------- |
  >| dict       | 成功返回整理好的字典，失败则只报错不返回 |

#### 文件相关服务

* ```python
  async def add_document(files, title, username, remark)
  ```

  功能描述：创建document的同时上传文件，支持同一文档(title)多文件上传，若document已存在，也可以用于添加文件

  >| 字段     | 类型             | 默认值 | 说明               | 是否必必须 |
  >| -------- | ---------------- | ------ | ------------------ | ---------- |
  >| files    | List[UploadFile] | /      | 上传的文件         | 是         |
  >| title    | str              | /      | 这次上次行为的标题 | 是         |
  >| username | str              | /      | 上传者的账号       | 是         |
  >| remark   | Optional[str]    | /      | 备注               | 否         |
  >
  >| 返回值类型 | 返回值说明                                                   |
  >| ---------- | ------------------------------------------------------------ |
  >| dict       | 成功返回含有'message'、'time'、'filename'、'file_path'信息的字典，失败则只报错不返回 |

* ```python
  def remove_document(title, filename)
  ```

  功能描述：删除指定title的document中的特定文件filename，若不指定文件则删除整个文档

  >| 字段     | 类型 | 默认值 | 说明       | 是否必必须 |
  >| -------- | ---- | ------ | ---------- | ---------- |
  >| title    | str  | /      | 标题       | 否         |
  >| username | str  | /      | 上传者账号 | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def get_document(title, limit, skip)
  ```

  功能描述：获取文档的信息，以title唯一指定，返回的链接是不带公网IP的

  >| 字段   | 类型 | 默认值 | 说明               | 是否必必须 |
  >| ------ | ---- | ------ | ------------------ | ---------- |
  >| titile | str  | /      | 文档标题           | 否         |
  >| limit  | int  | /      | 限制获取的数据条数 | 否         |
  >| skip   | int  | /      | 需要跳过的数据条数 | 是         |
  >
  >| 返回值类型                              | 返回值说明                                   |
  >| --------------------------------------- | -------------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 成功返回整理好的文件信息，失败则只报错不返回 |

* ```python
  def update_document(title, document)
  ```

  功能描述：更新文件的信息，以传入的title唯一指定

  >| 字段     | 类型     | 默认值 | 说明           | 是否必必须 |
  >| -------- | -------- | ------ | -------------- | ---------- |
  >| title    | str      | /      | 文档标题       | 是         |
  >| document | Document | /      | 更新的文件内容 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

#### 部门相关服务

* ```python
  def add_dept(dept)
  ```

  功能描述：添加部门

  >| 字段 | 类型       | 默认值 | 说明       | 是否必必须 |
  >| ---- | ---------- | ------ | ---------- | ---------- |
  >| dept | Department | /      | 上传的部门 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def remove_dept(name)
  ```

  功能描述：删除部门，以name唯一指定

  >| 字段 | 类型 | 默认值 | 说明     | 是否必必须 |
  >| ---- | ---- | ------ | -------- | ---------- |
  >| name | str  | /      | 部门名称 | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def get_dept(name, limit, skip)
  ```

  功能描述：获取部门的信息，以name唯一指定

  >| 字段  | 类型 | 默认值 | 说明               | 是否必必须 |
  >| ----- | ---- | ------ | ------------------ | ---------- |
  >| name  | str  | /      | 部门名称           | 否         |
  >| limit | int  | /      | 限制获取的数据条数 | 否         |
  >| skip  | int  | /      | 需要跳过的数据条数 | 是         |
  >
  >| 返回值类型                              | 返回值说明                                   |
  >| --------------------------------------- | -------------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 成功返回整理好的部门信息，失败则只报错不返回 |

* ```python
  def update_dept(name, dept)
  ```

  功能描述：更新文件的信息，以传入的name唯一指定

  >| 字段 | 类型       | 默认值 | 说明           | 是否必必须 |
  >| ---- | ---------- | ------ | -------------- | ---------- |
  >| name | str        | /      | 部门名称       | 否         |
  >| dept | Department | /      | 更新的部门信息 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

#### 职位相关服务

* ```python
  def add_job(job)
  ```

  功能描述：添加职位

  >| 字段 | 类型 | 默认值 | 说明       | 是否必必须 |
  >| ---- | ---- | ------ | ---------- | ---------- |
  >| job  | Job  | /      | 上传的职位 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| dict       | 成功返回'success'，失败则只报错不返回 |

* ```python
  def remove_job(name)
  ```

  功能描述：删除部门，以name唯一指定

  >| 字段 | 类型 | 默认值 | 说明     | 是否必必须 |
  >| ---- | ---- | ------ | -------- | ---------- |
  >| name | str  | /      | 职位名称 | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def get_job(name, limit, skip)
  ```

  功能描述：获取职位的信息，以name唯一指定

  >| 字段  | 类型 | 默认值 | 说明               | 是否必必须 |
  >| ----- | ---- | ------ | ------------------ | ---------- |
  >| name  | str  | /      | 职位名称           | 否         |
  >| limit | int  | /      | 限制获取的数据条数 | 否         |
  >| skip  | int  | /      | 需要跳过的数据条数 | 是         |
  >
  >| 返回值类型                              | 返回值说明                                   |
  >| --------------------------------------- | -------------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 成功返回整理好的职位信息，失败则只报错不返回 |

* ```python
  def update_dept(name, dept)
  ```

  功能描述：更新职位的信息，以传入的name唯一指定

  >| 字段 | 类型       | 默认值 | 说明           | 是否必必须 |
  >| ---- | ---------- | ------ | -------------- | ---------- |
  >| name | str        | /      | 职位名称       | 否         |
  >| dept | Department | /      | 更新的职位信息 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

#### 公告相关服务

* ```python
  def add_notice(title, username, content)
  ```

  功能描述：添加公告

  >| 字段     | 类型   | 默认值 | 说明       | 是否必必须 |
  >| -------- | ------ | ------ | ---------- | ---------- |
  >| title    | Notice | /      | 公告的标题 | 是         |
  >| username | str    | /      | 上传者账号 | 是         |
  >| content  | str    | /      | 公告内容   | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def remove_notice(title)
  ```

  功能描述：删除公告，以title唯一指定

  >| 字段  | 类型 | 默认值 | 说明     | 是否必必须 |
  >| ----- | ---- | ------ | -------- | ---------- |
  >| title | str  | /      | 公告标题 | 否         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

* ```python
  def get_notice(title, limit, skip)
  ```

  功能描述：获取职位的信息，以name唯一指定

  >| 字段  | 类型 | 默认值 | 说明               | 是否必必须 |
  >| ----- | ---- | ------ | ------------------ | ---------- |
  >| title | str  | /      | 公告标题           | 否         |
  >| limit | int  | /      | 限制获取的数据条数 | 否         |
  >| skip  | int  | /      | 需要跳过的数据条数 | 是         |
  >
  >| 返回值类型                              | 返回值说明                                   |
  >| --------------------------------------- | -------------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 成功返回整理好的公告信息，失败则只报错不返回 |

* ```python
  def update_notice(title, notice)
  ```

  功能描述：更新职位的信息，以传入的name唯一指定

  >| 字段   | 类型   | 默认值 | 说明           | 是否必必须 |
  >| ------ | ------ | ------ | -------------- | ---------- |
  >| title  | str    | /      | 公告标题       | 否         |
  >| notice | Notice | /      | 更新的公告信息 | 是         |
  >
  >| 返回值类型 | 返回值说明                            |
  >| ---------- | ------------------------------------- |
  >| str        | 成功返回'success'，失败则只报错不返回 |

---

### 3. 逻辑层接口

作为整个架构的底层，我们给后端开发人员设计了多个参数，以适应不同的数据操作需求。

* ```python
  def insert_items(table_name, columns, values)
  ```
  
  功能描述：表单插入，支持同时插入多条记录
  
  >```python
  >>>>Example:
  >insert_items(table_name='person',
  >           columns=['name', 'age'],
  >           values=[['周杰伦', 30], ['马云', 35]])
  >```
  >
  >| 字段       | 类型                               | 默认值 | 说明                                                         | 是否必必须 |
  >| ---------- | ---------------------------------- | ------ | ------------------------------------------------------------ | ---------- |
  >| table_name | str                                | /      | 要插入的表名                                                 | 是         |
  >| columns    | List[str]                          | /      | 指明要插入的表属性，必须包含表中没有默认参数的属性，不允许为空列表 | 是         |
  >     | values     | List[List[Union[str, int, float]]] | /      | 对应要插入的属性的值列表，列表里每个值要与colums对应         | 是         |
  >     
  >| 返回值类型 | 返回值说明                                |
  >| ---------- | ----------------------------------------- |
  >| str        | 插入成功返回'success'，失败则只报错不返回 |
  
  

* ```python
  def delete_items(table_name, where)
  ```

  功能描述：单表删除，一次可以根据传入条件删除多条记录。注意传入where要小心，不然很容易误删，如果指定的条件对应的记录不存在也会返回success

  >```python
  >>>>Example:
  >delete_items(table_name='person',
  >            where={"name": "周杰伦", "age": 30})
  >```
  >
  >| 字段       | 类型                                        | 默认值 | 说明                                                         | 是否必必须 |
  >| ---------- | ------------------------------------------- | ------ | ------------------------------------------------------------ | ---------- |
  >| table_name | str                                         | /      | 要删除的表名                                                 | 是         |
  >| where      | Optional[Dict[str, Union[str, int, float]]] | None   | 要删除的条件键值对，若为None或空字典删除整个表或所有指定的colums条目，目前只能使用=判断 | 否         |
  >
  >| 返回值类型 | 返回值说明                          |
  >| ---------- | ----------------------------------- |
  >| str        | 删除成功返回'success'，失败则不返回 |

  

* ```python
  def select_items(table_name, colunms, where, limit, skip)
  ```

  功能描述：单表查询，返回一个包含数个查询条目的列表

  >```python
  >>>>Example:
  >select_items(table_name='person',
  >                columns=['name', 'age'],
  >                where={'name':'周杰伦', 'age':20})
  >```
  >
  >| 字段       | 类型                                        | 默认值 | 说明                                                         | 是否必必须 |
  >| ---------- | ------------------------------------------- | ------ | ------------------------------------------------------------ | ---------- |
  >| table_name | str                                         | /      | 要查询的表名                                                 | 是         |
  >| colunms    | Optional[List[str]]                         | None   | 要查询的属性，若为None或空列表则返回全部属性                 | 否         |
  >| where      | Optional[Dict[str, Union[str, int, float]]] | None   | 要查询的条件键值对，若为None或空字典返回整个表或所有指定的colums条目，目前只能使用=判断 | 否         |
  >| limit      | Optional[int]                               | None   | 返回条目的最大数量，为None时全部返回                         | 否         |
  >| skip       | int                                         | 0      | 返回条目的查询偏移                                           | 否         |
  >
  >| 返回值类型                              | 返回值说明                                         |
  >| --------------------------------------- | -------------------------------------------------- |
  >| List[Dict[str, Union[str, int, float]]] | 一个包含数个查询条目的列表，查询失败则只报错不返回 |

  

* ```python
  def update_items(table_name, items, where)
  ```

  功能描述：单表更新

  >```python
  >>>>Example:
  >update_items(table_name='person',
  >            items={'name': 'Jay', 'age': 21},
  >            where={'name': '周杰伦', 'age': 20})
  >```
  >
  >| 字段       | 类型                                        | 默认值 | 说明                                                         | 是否必必须 |
  >| ---------- | ------------------------------------------- | ------ | ------------------------------------------------------------ | ---------- |
  >| table_name | str                                         | /      | 要更新的表名                                                 | 是         |
  >| items      | Dict[str, Union[str, int, float]]           | /      | 要更新的属性与值，若为None或者大小为0则不更新                | 是         |
  >| where      | Optional[Dict[str, Union[str, int, float]]] | None   | 要更新的条件键值对，若为None或空字典更新整个表或所有指定的colums条目，目前只能使用=判断 | 否         |
  >
  >| 返回值类型 | 返回值说明                                |
  >| ---------- | ----------------------------------------- |
  >| str        | 插入成功返回'success'，失败则只报错不返回 |

  > 
  >
  > ```python
  > >>>Example:
  > update_items(table_name='person',
  >                  items={'name': 'Jay', 'age': 21},
  >                  where={'name': '周杰伦', 'age': 20})
  > ```
  >
  > | 字段       | 类型                                        | 默认值 | 说明                                                         | 是否必必须 |
  > | ---------- | ------------------------------------------- | ------ | ------------------------------------------------------------ | ---------- |
  > | table_name | str                                         | /      | 要更新的表名                                                 | 是         |
  > | items      | Dict[str, Union[str, int, float]]           | /      | 要更新的属性与值，若为None或者大小为0则不更新                | 是         |
  > | where      | Optional[Dict[str, Union[str, int, float]]] | None   | 要更新的条件键值对，若为None或空字典更新整个表或所有指定的colums条目，目前只能使用=判断 | 否         |
  >
  > | 返回值类型 | 返回值说明                                |
  > | ---------- | ----------------------------------------- |
  > | str        | 插入成功返回'success'，失败则只报错不返回 |

## 三、代码规范

### 运行环境

> 仅列出主要安装的库。

```
# Name                    Version                   Build  Channel
python                    3.7.11               h6244533_0    defaults
aiofiles                  0.7.0                    pypi_0    pypi
fastapi                   0.68.0                   pypi_0    pypi
PyMySQL                   1.0.2                    pypi_0    pypi
uvicorn                   0.15.0                   pypi_0    pypi
```

### 开发者须知

#### 文件存放

- `api`存放各功能模块需要调用的接口，即控制层。
- `assert`存放静态资源。
- `dao`存放与数据库有关的操作，即数据层。
- `service`存放与数据处理、行为逻辑有关的操作，即逻辑层。
- `model`存放自定义类等，即模型层。
- `img`存放readme中使用到的图片。

### 代码规范

- 使用pep8编码规范，vscode的话可以通过在`setting.json`文件中设置`"python.formatting.provider": "autopep8"`从而使默认的格式化文档风格为pep8，**写完代码后保持格式化文档一下的习惯**，下面说的是只靠格式化解决不了的问题。
- 引入第三方库别用`from ... import *`，用`import`或者要用啥引啥，比如`from PyQt5 import QWidget`，引用自己写的模块视情况而定。尽量不要将所有的内容全引入了，这样会很臃肿。引入内容按照__字典序排列__。
- 正式内容与引入内容间隔两行，类外函数两两间间隔两行，内类函数两两间间隔一行。

以下几点点均可以在编辑器中设置<img src="D:\aMyNothing\Project\SummerTrain\后端\backend\rearend\img\image-20210820151023689.png" alt="image-20210820151023689" style="zoom:80%;" />，修改可以参考https://www.cxyzjd.com/article/github_38851471/85268075（记得git的也要改，这是为了避免：https://github.com/cssmagic/blog/issues/22）。

- 使用 **4 空格缩进**，禁用任何 TAB 符号（编辑器或者idle可以设置自动将tab转成空格）。
- 源码文件使用 **UTF-8 无 BOM 编码格式（UTF-8）**。
- 总是使用 **Unix \n 风格换行符（LF）**。

- 在每一个 py 文件头，都添加如下内容：

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# 描述
```

#### 函数规范

- 函数名使用小写单词命名，多个单词之间用下划线连接，保护函数以下划线开头，私有函数以下双下划线开头（继承父类来的比如`paintEvent`来的就没办法了）：

```python
def demo_function():
	pass
def _private_function():
	pass
```

下面两点的语法可参考：https://docs.python.org/zh-cn/3/library/typing.html

- 自定义函数要表明返回值类型（接口可以省了反正都是一样的）

```python
def heihei(): -> None
    pass
def hah(): -> bool
    return True
```

- 函数参数需要注明类型

```python
def get_users(uname: str):
    return userService.getUserInfos(uname)
```

- 函数的开头要写功能**注释**，并且给出参数解释，特殊情况下给出__返回值解释__和__示例__

```python
def hhh():
    r"""balabala
    """
    pass

def hhh2(para_1: str, para_2: int):
    r"""
    balabala
    
    Args:
    	para_1(str): balabala
    				balabala
	    para_2(int): balabala
    """
    pass
```

- 代码块中的注释可写可不写，但尽量写块注释而不是行注释：

```python
# 我是块注释
pass
pass

pass # 我是行注释
```

#### 文件命名规范

- 文件和文件夹使用**小写单词**命名，多个单词之间用下划线连接：

```python
demo_module
demo_do_something.py
```

#### 类命名规范

- 类名：（大驼峰原则）

每个单词的首字母大写，私有类以下划线开头，后面也是每个单词的首字母大写，多个单词拼接：

```python
class DemoClass():
	pass
class _PrivateClass():
	pass
```

#### 变量规范

- 变量名：

  使用小写单词命名，多个单词之间用下划线连接：

```python
demo_variable = "Hello Python"
```

- 常量：

  使用大写单词命名，多个单词之间用下划线连接：

```python
DEMO_CONSTANT = 100
```

* 全局变量位置：

  在引入内容下方，正式内容上方。与引入内容间隔一行，与正式内容间隔两行

```python
from somefile import something

file_path = "balabalabala"


def get():
    pass
```

* 列表书写格式：
  仅有单行数值可以在同一行表示，其他均需换行表示

```python
list_1 = [1, 2, 3, 4]

list_2 = [
    "sdf", "sdf", "sdf"
]

list_3 = [
    [1, 1, 1, 1],
    [2, 2, 2, 2],
    [3, 3, 3, 3]
]
```

* 字典书写格式：
  内容均需要换行

```python
dict_1 = {
    "key": value,
    "key_2": value
}
```

### Github上传规则

多人协作的工作模式通常是这样：

1. 首先，可以试图用`git push origin <branch-name>`推送自己的修改；
2. 如果推送失败，则因为远程分支比你的本地更新，需要先用`git pull`试图合并；
3. 如果合并有冲突，则解决冲突，并在本地提交；
4. 没有冲突或者解决掉冲突后，再用`git push origin <branch-name>`推送就能成功！

如果`git pull`提示`no tracking information`，则说明本地分支和远程分支的链接关系没有创建，用命令`git branch --set-upstream-to <branch-name> origin/<branch-name>`。

详见：https://www.liaoxuefeng.com/wiki/896043488029600/900375748016320

如果你不想你的工作被别人的push打扰，可以自己开一个分支，比如`git branch lxh`在上面提交，然后之后再将`lxh`和`main`合并。